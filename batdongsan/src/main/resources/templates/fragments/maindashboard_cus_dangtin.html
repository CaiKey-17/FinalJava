<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.w3.org/1999/xhtml">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Post Land for Sale</title>
    <script>
        // Function to update property type options based on the selected type
        function updatePropertyTypeOptions() {
            const propertyTypeSelect = document.getElementById("propertyType");
            const type = document.getElementById("type").value;

            // Clear current options
            propertyTypeSelect.innerHTML = '';

            // Add new options based on 'type' (Bán or Cho thuê)
            let options = [];
            if (type === "Bán") {
                options = ["Căn hộ", "Chung cư", "Nhà riêng", "Biệt thự"];
            } else if (type === "Cho thuê") {
                options = ["Căn hộ", "Chung cư", "Nhà riêng", "Biệt thự"];
            }

            // Add options to the select
            options.forEach(function(option) {
                const opt = document.createElement("option");
                opt.value = option;
                opt.textContent = option;
                propertyTypeSelect.appendChild(opt);
            });
        }

        // Function to post the land data
        function postLand() {
    const formData = new FormData();

    formData.append("name", document.getElementById("name").value);
    formData.append("price", parseInt(document.getElementById("price").value));
    formData.append("area", parseFloat(document.getElementById("area").value));
    formData.append("city", document.getElementById("city").value);
    formData.append("district", document.getElementById("district").value);
    formData.append("ward", document.getElementById("ward").value);
    formData.append("interior", document.getElementById("interior").value);
    formData.append("numberOfToilets", parseInt(document.getElementById("numberOfToilets").value));
    formData.append("numberOfBedRooms", parseInt(document.getElementById("numberOfBedRooms").value));
    formData.append("description", CKEDITOR.instances.description.getData());
    formData.append("datePosted", document.getElementById("datePosted").value);
    formData.append("type", document.getElementById("type").value);
    formData.append("legal", document.getElementById("legal").value);
    formData.append("propertyType", document.getElementById("propertyType").value);
    formData.append("userId", document.getElementById("userId").value);
    formData.append("availableId", document.getElementById("availableId").value);

    // Thêm file ảnh
  // Thêm file ảnh
const images = document.getElementById("images").files;
for (let i = 0; i < images.length; i++) {
    formData.append("imageLinks", images[i]); // Đổi tên thành "imageLinks"
}


    fetch('/post', {
        method: 'POST',
        body: formData
    })
    .then(response => {
        if (response.ok) {
            return response.json();
        } else {
            throw new Error("Failed to post land data");
        }
    })
    .then(data => {
        alert("Post successful!");
        console.log(data);
    })
    .catch(error => {
        alert("Error: " + error.message);
        console.error('Error:', error);
    });
}

    </script>

    <script>
        // Tự động lấy thời gian hiện tại và đặt vào trường datetime-local
        window.addEventListener("load", function() {
            const dateInput = document.getElementById("datePosted");

            // Lấy thời gian hiện tại
            const now = new Date();

            // Định dạng thời gian thành yyyy-MM-ddTHH:mm
            const formattedDate = now.toISOString().slice(0, 16);

            // Gán giá trị này cho input
            dateInput.value = formattedDate;
        });
    </script>
    <script src="https://cdn.ckeditor.com/4.20.2/standard/ckeditor.js"></script>


</head>
<body>

<h2>Post Land for Sale</h2>
<form onsubmit="event.preventDefault(); postLand();" enctype="multipart/form-data">
    <label for="name">Name:</label>
    <input type="text" id="name" name="name"  required><br><br>

    <label for="price">Price:</label>
    <input type="number" id="price" name="price"  required><br><br>

    <label for="area">Area:</label>
    <input type="number" step="0.1" id="area" name="area"  required><br><br>


    <label for="interior">Interior:</label>
    <input type="text" id="interior" name="interior"  required><br><br>

    <label for="numberOfToilets">Number of Toilets:</label>
    <input type="number" id="numberOfToilets" name="numberOfToilets" required><br><br>

    <label for="numberOfBedRooms">Number of Bedrooms:</label>
    <input type="number" id="numberOfBedRooms" name="numberOfBedRooms"  required><br><br>

    <label for="description">Description:</label>
    <textarea id="description" name="description"></textarea><br><br>
    <script>
        CKEDITOR.replace('description'); // Tích hợp CKEditor
    </script>




    <label for="datePosted">Date Posted:</label>
    <input type="datetime-local" id="datePosted" name="datePosted" required><br><br>

    <label for="type">Type:</label>
    <select id="type" name="type" required onchange="updatePropertyTypeOptions()">
        <option value="Bán" selected>Bán</option>
        <option value="Cho thuê">Cho thuê</option>
    </select><br><br>

    <label for="propertyType">Property Type:</label>
    <select id="propertyType" name="propertyType" required>
        <!-- Options will be dynamically added based on the selected type -->
        <option value="Căn hộ" selected>Căn hộ</option>
        <option value="Chung cư">Chung cư</option>
        <option value="Nhà riêng">Nhà riêng</option>
        <option value="Biệt thự">Biệt thự</option>
        <option value="Nhà mặt phố">Nhà mặt phố</option>
    </select><br><br>

    <label for="legal">Legal:</label>
    <input type="text" id="legal" name="legal" value="Sổ đỏ chính chủ" required><br><br>

    <label for="images">Upload Images:</label>
    <input type="file" id="images" name="images" accept="image/*" multiple required><br><br>


    <label for="availableId">Available:</label>
    <select id="availableId" name="availableId" required>
        <th:block th:each="available : ${availableList}">
            <option th:value="${available.orderId}" th:text="${available.orderId}"></option>
        </th:block>
    </select><br><br>



    <!-- Hidden field for userId -->
    <input type="hidden" id="userId" name="userId" th:value="${userId}">


        <label for="city">Chọn tỉnh/thành phố:</label>
        <select class="form-select form-select-sm mb-3" id="city" name="city" aria-label=".form-select-sm">
            <option value="" selected>Chọn tỉnh thành</option>
        </select>

        <label for="district">Chọn quận/huyện:</label>
        <select class="form-select form-select-sm mb-3" id="district" aria-label=".form-select-sm">
            <option value="" selected>Chọn quận huyện</option>
        </select>

        <label for="ward">Chọn xã/phường:</label>
        <select class="form-select form-select-sm" id="ward" aria-label=".form-select-sm">
            <option value="" selected>Chọn phường xã</option>
        </select>

    <button type="submit">Post Land</button>
</form>


<h2>Post News</h2>
<form onsubmit="event.preventDefault(); postNews();" enctype="multipart/form-data">
    <label for="title">Title:</label>
    <input type="text" id="title" name="title" required><br><br>

    <label for="summaryOfContent">Summary of Content:</label>
    <input type="text" id="summaryOfContent" name="summaryOfContent" required><br><br>

    <label for="content">Content:</label>
    <textarea id="content" name="content" required></textarea><br><br>
    <script>
        CKEDITOR.replace('content'); // Integrate CKEditor for content editing
    </script>

    <label for="availableId1">Available:</label>
    <select id="availableId1" name="availableId1" required>
        <!-- Thymeleaf loop to populate options dynamically from availableList -->
        <th:block th:each="available : ${availableList}">
            <option th:value="${available.orderId}" th:text="${available.orderId}"></option>
        </th:block>
    </select><br><br>

    <!-- Hidden field for userId1 -->
    <input type="hidden" id="userId1" name="userId1" th:value="${userId}"><br><br>

    <label for="images1">Upload Images:</label>
    <input type="file" id="images1" name="imageLinks" accept="image/*" multiple><br><br>

    <button type="submit">Post News</button>
</form>

<script>
    function postNews() {
        const formData = new FormData();
        formData.append("title", document.getElementById("title").value);
        formData.append("summaryOfContent", document.getElementById("summaryOfContent").value);
        formData.append("content", CKEDITOR.instances.content.getData());
        formData.append("userId1", document.getElementById("userId1").value); // userId1 hidden field
        formData.append("availableId1", document.getElementById("availableId1").value); // availableId1 dropdown

        // Add images if any
        const images1 = document.getElementById("images1").files;
        for (let i = 0; i < images1.length; i++) {
            formData.append("imageLinks", images1[i]);
        }

        fetch('/post-news', {
            method: 'POST',
            body: formData
        })
        .then(response => response.json())
        .then(data => {
            alert("Post successful!");
            console.log(data);
        })
        .catch(error => {
            alert("Error: " + error.message);
            console.error('Error:', error);
        });
    }
</script>



</body>

<script src="https://cdnjs.cloudflare.com/ajax/libs/axios/0.21.1/axios.min.js"></script>
<script>
    var citis = document.getElementById("city");
    var districts = document.getElementById("district");
    var wards = document.getElementById("ward");

    var Parameter = {
        url: "https://raw.githubusercontent.com/kenzouno1/DiaGioiHanhChinhVN/master/data.json",
        method: "GET",
        responseType: "application/json",
    };

    var promise = axios(Parameter);
    promise.then(function (result) {
        renderCity(result.data);
    });

  function renderCity(data) {
    for (const x of data) {
        citis.options[citis.options.length] = new Option(x.Name, x.Name); // Sử dụng x.Name làm giá trị
    }

    citis.onchange = function () {
        districts.length = 1; // Reset danh sách quận/huyện
        wards.length = 1; // Reset danh sách phường/xã
        if (this.value !== "") {
            const result = data.filter(n => n.Name === this.value); // So sánh với Name
            for (const k of result[0].Districts) {
                districts.options[districts.options.length] = new Option(k.Name, k.Name); // Sử dụng k.Name
            }
        }
    };

    districts.onchange = function () {
        wards.length = 1; // Reset danh sách phường/xã
        const dataCity = data.filter(n => n.Name === citis.value); // So sánh với Name
        if (this.value !== "") {
            const dataWards = dataCity[0].Districts.filter(n => n.Name === this.value)[0].Wards; // So sánh với Name
            for (const w of dataWards) {
                wards.options[wards.options.length] = new Option(w.Name, w.Name); // Sử dụng w.Name
            }
        }
    };
}

</script>

</html>
